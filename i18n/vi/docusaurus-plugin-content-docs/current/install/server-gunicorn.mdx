---
sidebar_position: 1
title: 'Gunnicorn & Nginx'
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# ğŸš€ Triá»ƒn khai á»¨ng dá»¥ng trÃªn Ubuntu vá»›i Gunicorn vÃ  Nginx

HÆ°á»›ng dáº«n nÃ y sáº½ giÃºp báº¡n triá»ƒn khai á»©ng dá»¥ng vá»›i Gunicorn lÃ m mÃ¡y chá»§ WSGI vÃ  Nginx lÃ m proxy ngÆ°á»£c trÃªn mÃ¡y chá»§ Ubuntu.

---

## ğŸ§° YÃªu cáº§u

- MÃ¡y chá»§ Ubuntu 20.04 hoáº·c 22.04
- CÃ i Ä‘áº·t Python 3
- Quyá»n `sudo` hoáº·c tÃ i khoáº£n root
- Äáº£m báº£o cÃ³ thá»ƒ truy cáº­p qua IP hoáº·c domain
- MÃ£ nguá»“n Ä‘Æ°á»£c cung cáº¥p bá»Ÿi **Python Vietnam** - [Xem chi tiáº¿t](https://pythonvn.com/ecom-python/)

---

## Step 1: ğŸ”§ Cáº­p nháº­t há»‡ thá»‘ng

```bash
sudo apt update && sudo apt upgrade -y
```

## Step 2: ğŸ CÃ i Ä‘áº·t Python, pip vÃ  venv (náº¿u chÆ°a cÃ i Ä‘áº·t)

```bash
sudo apt install python3 python3-pip python3-venv -y
```

## Step 3: ğŸ—ï¸ Táº¡o dá»± Ã¡n vÃ  mÃ´i trÆ°á»ng

```bash
mkdir ~/project_name
cd ~/project_name
python3 -m venv venv
source venv/bin/activate
```

## Step 4: ğŸ“¤ Táº£i mÃ£ lÃªn mÃ¡y chá»§

**Di chuyá»ƒn mÃ£ Ä‘áº¿n mÃ¡y chá»§ báº±ng ssh**

- MÃ¡y chá»§ Ubuntu Ä‘ang cháº¡y, cÃ³ tÃ i khoáº£n SSH (eg ubuntu@123.123.123.123)
- Táº¡o thÆ° má»¥c trÃªn mÃ¡y chá»§ dáº¡ng /home/user/flask_project
- CÃ i Ä‘áº·t Python, Flask, Gunicorn, Nginx trÃªn mÃ¡y chá»§ nhÆ° hÆ°á»›ng dáº«n á»Ÿ trÃªn

**ğŸ”‘ Kiá»ƒm tra quyá»n truy cáº­p mÃ¡y chá»§ SSH**

```bash
ssh ubuntu@123.123.123.123
```

**Náº¿u Ä‘Æ°á»£c nháº¯c nháº­p máº­t kháº©u: hÃ£y nháº­p máº­t kháº©u vÃ o Hoáº·c thiáº¿t láº­p khÃ³a SSH Ä‘á»ƒ thuáº­n tiá»‡n (cháº¡y má»™t láº§n):**

```bash
ssh-keygen -t rsa -b 4096
ssh-copy-id ubuntu@123.123.123.123
```

<Tabs>
    <TabItem value="Window" label="Window" default>
        Sá»­ dá»¥ng á»©ng dá»¥ng bÃªn dÆ°á»›i Ä‘á»ƒ káº¿t ná»‘i vÃ  táº£i mÃ£ lÃªn mÃ¡y chá»§:

        - [WinSCP](https://winscp.net/eng/index.php)
        - [FileZilla](https://filezilla-project.org/)
    </TabItem>
    <TabItem value="Mac Os" label="Mac Os">
        **Táº£i lÃªn sá»­ dá»¥ng Scp:**

        ```bash
        scp -r ~/folder-local/*  user@<IP>:/project-folder
        ```

        - **folder-local:** ÄÆ°á»ng dáº«n thÆ° má»¥c dá»± Ã¡n trÃªn mÃ¡y tÃ­nh cá»§a báº¡n.
        - **project-folder:** ÄÆ°á»ng dáº«n thÆ° má»¥c dá»± Ã¡n trÃªn mÃ¡y chá»§.

        **Táº£i lÃªn sá»­ dá»¥ng Rsync:**

        ```bash
        rsync -avz ~/folder-local/* user@<IP>:/project-folder
        ```

        - **folder-local:** Project folder path on your computer.
        - **project-folder:** Project folder path on server.
    </TabItem>
</Tabs>

**Cáº¥u trÃºc thÆ° má»¥c**

```bash
/home/<user>/<project_name>/
|â€“â€“ app
â”œâ”€â”€ wsgi.py
â”œâ”€â”€ venv/
|â€“â€“ requirements.txt
â””â”€â”€ config.py
```

## Step 5: ğŸ”¥ CÃ i Ä‘áº·t cÃ¡c yÃªu cáº§u vÃ  test á»©ng dá»¥ng

**CÃ i Ä‘áº·t cÃ¡c gÃ³i yÃªu cáº§u:**

```bash
pip install -r requirements.txt
```

**Test á»©ng dá»¥ng:**

```bash
python wsgi.py
```

**DÃ²ng lá»‡nh hiá»ƒn thá»‹ nhÆ° sau lÃ  thÃ nh cÃ´ng.**

```shell
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on http://127.0.0.1:5000
Press CTRL+C to quit
 * Restarting with stat
```

## Step 6: ğŸŒ CÃ i Ä‘áº·t vÃ  cáº¥u hÃ¬nh Nginx

**CÃ i Ä‘áº·t Nginx:**

```bash
sudo apt install nginx -y
```

**Táº¡o má»™t táº­p tin cáº¥u hÃ¬nh má»›i:**

```bash
sudo nano /etc/nginx/sites-available/project_name
```

**Copy vÃ  dÃ¡n mÃ£ sau vÃ  thay Ä‘á»•i thÃ´ng tin cá»§a báº¡n:**

```bash
server {
    listen 80;
    server_name domain_name.com;  # Change this to your domain_name if you have one

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

**KÃ­ch hoáº¡t Sites Enabled:**

```bash
sudo ln -s /etc/nginx/sites-available/flask_project /etc/nginx/sites-enabled
```

**sudo rm /etc/nginx/sites-enabled/default**

```bash
sudo rm /etc/nginx/sites-enabled/default
```

**Kiá»ƒm tra vÃ  khá»Ÿi Ä‘á»™ng láº¡i Nginx:**

```bash
sudo nginx -t
sudo systemctl restart nginx
```

## Step 7: âš™ï¸ Cháº¡y Gunicorn dÆ°á»›i dáº¡ng dá»‹ch vá»¥ systemd

**Táº¡o táº­p tin dá»‹ch vá»¥:**

```bash
sudo nano /etc/systemd/system/flask_project.service
```

**DÃ¡n vÃ  Ä‘iá»u chá»‰nh Ä‘Æ°á»ng dáº«n vÃ  ngÆ°á»i dÃ¹ng cho phÃ¹ há»£p trÃªn mÃ¡y chá»§ cá»§a báº¡n:**

```bash
[Unit]
Description=Gunicorn instance to serve Project Name
After=network.target

[Service]
User=$USER
Group=$GROUP
WorkingDirectory=/home/user/project_folder # Path project folder
Environment="PATH=/home/user/project_folder/venv/bin" # Path project /bin
ExecStart=/home/user/project_folder/venv/bin/gunicorn --workers 3 --bind unix:project_name.sock -m 007 wsgi:app --access-logfile /home/user/project_folder/log/access.log --error-logfile /home/user/project_folder/log/error.log

[Install]
WantedBy=multi-user.target
```

:::warning
ChÃº Ã½ thay Ä‘Æ°á»ng dáº«n chÃ­nh xÃ¡c theo cáº¥u trÃºc thÆ° má»¥c dá»± Ã¡n trÃªn nÃ¡y ch**á»§:**
- **/home/user:** NgÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p ssh hiá»‡n táº¡i
- **/home/user/project_folder:** ThÆ° má»¥c dá»± Ã¡n
:::

**Táº£i láº¡i vÃ  kÃ­ch hoáº¡t:**

```bash
sudo systemctl daemon-reexec
sudo systemctl start project_name
sudo systemctl enable project_name
```

**Kiá»ƒm tra tráº¡ng thÃ¡i:**

```bash
sudo systemctl status flask_project
```

## ğŸ” (TÃ¹y chá»n) KÃ­ch hoáº¡t HTTPS báº±ng Let's Encrypt

```bash
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx
```

LÃ m theo lá»i nháº¯c Ä‘á»ƒ nháº­n chá»©ng chá»‰ SSL miá»…n phÃ­.

## âœ… Truy cáº­p á»©ng dá»¥ng cá»§a báº¡n

Má»Ÿ trÃ¬nh duyá»‡t cá»§a báº¡n vÃ  Ä‘i Ä‘áº¿n:

```bash
https://your-domain.com
```