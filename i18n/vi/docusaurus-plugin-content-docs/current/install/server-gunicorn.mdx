---
sidebar_position: 1
title: 'Gunnicorn & Nginx'
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# 🚀 Triển khai Ứng dụng trên Ubuntu với Gunicorn và Nginx

Hướng dẫn này sẽ giúp bạn triển khai ứng dụng với Gunicorn làm máy chủ WSGI và Nginx làm proxy ngược trên máy chủ Ubuntu.

---

## 🧰 Yêu cầu

- Máy chủ Ubuntu 20.04 hoặc 22.04
- Cài đặt Python 3
- Quyền `sudo` hoặc tài khoản root
- Đảm bảo có thể truy cập qua IP hoặc domain
- Mã nguồn được cung cấp bởi **Python Vietnam** - [Xem chi tiết](https://pythonvn.com/ecom-python/)

---

## Step 1: 🔧 Cập nhật hệ thống

```bash
sudo apt update && sudo apt upgrade -y
```

## Step 2: 🐍 Cài đặt Python, pip và venv (nếu chưa cài đặt)

```bash
sudo apt install python3 python3-pip python3-venv -y
```

## Step 3: 🏗️ Tạo dự án và môi trường

```bash
mkdir ~/project_name
cd ~/project_name
python3 -m venv venv
source venv/bin/activate
```

## Step 4: 📤 Tải mã lên máy chủ

**Di chuyển mã đến máy chủ bằng ssh**

- Máy chủ Ubuntu đang chạy, có tài khoản SSH (eg ubuntu@123.123.123.123)
- Tạo thư mục trên máy chủ dạng /home/user/flask_project
- Cài đặt Python, Flask, Gunicorn, Nginx trên máy chủ như hướng dẫn ở trên

**🔑 Kiểm tra quyền truy cập máy chủ SSH**

```bash
ssh ubuntu@123.123.123.123
```

**Nếu được nhắc nhập mật khẩu: hãy nhập mật khẩu vào Hoặc thiết lập khóa SSH để thuận tiện (chạy một lần):**

```bash
ssh-keygen -t rsa -b 4096
ssh-copy-id ubuntu@123.123.123.123
```

<Tabs>
    <TabItem value="Window" label="Window" default>
        Sử dụng ứng dụng bên dưới để kết nối và tải mã lên máy chủ:

        - [WinSCP](https://winscp.net/eng/index.php)
        - [FileZilla](https://filezilla-project.org/)
    </TabItem>
    <TabItem value="Mac Os" label="Mac Os">
        **Tải lên sử dụng Scp:**

        ```bash
        scp -r ~/folder-local/*  user@<IP>:/project-folder
        ```

        - **folder-local:** Đường dẫn thư mục dự án trên máy tính của bạn.
        - **project-folder:** Đường dẫn thư mục dự án trên máy chủ.

        **Tải lên sử dụng Rsync:**

        ```bash
        rsync -avz ~/folder-local/* user@<IP>:/project-folder
        ```

        - **folder-local:** Project folder path on your computer.
        - **project-folder:** Project folder path on server.
    </TabItem>
</Tabs>

**Cấu trúc thư mục**

```bash
/home/<user>/<project_name>/
|–– app
├── wsgi.py
├── venv/
|–– requirements.txt
└── config.py
```

## Step 5: 🔥 Cài đặt các yêu cầu và test ứng dụng

**Cài đặt các gói yêu cầu:**

```bash
pip install -r requirements.txt
```

**Test ứng dụng:**

```bash
python wsgi.py
```

**Dòng lệnh hiển thị như sau là thành công.**

```shell
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on http://127.0.0.1:5000
Press CTRL+C to quit
 * Restarting with stat
```

## Step 6: 🌐 Cài đặt và cấu hình Nginx

**Cài đặt Nginx:**

```bash
sudo apt install nginx -y
```

**Tạo một tập tin cấu hình mới:**

```bash
sudo nano /etc/nginx/sites-available/project_name
```

**Copy và dán mã sau và thay đổi thông tin của bạn:**

```bash
server {
    listen 80;
    server_name domain_name.com;  # Change this to your domain_name if you have one

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

**Kích hoạt Sites Enabled:**

```bash
sudo ln -s /etc/nginx/sites-available/flask_project /etc/nginx/sites-enabled
```

**sudo rm /etc/nginx/sites-enabled/default**

```bash
sudo rm /etc/nginx/sites-enabled/default
```

**Kiểm tra và khởi động lại Nginx:**

```bash
sudo nginx -t
sudo systemctl restart nginx
```

## Step 7: ⚙️ Chạy Gunicorn dưới dạng dịch vụ systemd

**Tạo tập tin dịch vụ:**

```bash
sudo nano /etc/systemd/system/flask_project.service
```

**Dán và điều chỉnh đường dẫn và người dùng cho phù hợp trên máy chủ của bạn:**

```bash
[Unit]
Description=Gunicorn instance to serve Project Name
After=network.target

[Service]
User=$USER
Group=$GROUP
WorkingDirectory=/home/user/project_folder # Path project folder
Environment="PATH=/home/user/project_folder/venv/bin" # Path project /bin
ExecStart=/home/user/project_folder/venv/bin/gunicorn --workers 3 --bind unix:project_name.sock -m 007 wsgi:app --access-logfile /home/user/project_folder/log/access.log --error-logfile /home/user/project_folder/log/error.log

[Install]
WantedBy=multi-user.target
```

:::warning
Chú ý thay đường dẫn chính xác theo cấu trúc thư mục dự án trên náy ch**ủ:**
- **/home/user:** Người dùng đăng nhập ssh hiện tại
- **/home/user/project_folder:** Thư mục dự án
:::

**Tải lại và kích hoạt:**

```bash
sudo systemctl daemon-reexec
sudo systemctl start project_name
sudo systemctl enable project_name
```

**Kiểm tra trạng thái:**

```bash
sudo systemctl status flask_project
```

## 🔐 (Tùy chọn) Kích hoạt HTTPS bằng Let's Encrypt

```bash
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx
```

Làm theo lời nhắc để nhận chứng chỉ SSL miễn phí.

## ✅ Truy cập ứng dụng của bạn

Mở trình duyệt của bạn và đi đến:

```bash
https://your-domain.com
```