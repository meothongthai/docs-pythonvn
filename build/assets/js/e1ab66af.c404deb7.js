"use strict";(self.webpackChunkpythonvn_docs=self.webpackChunkpythonvn_docs||[]).push([[829],{3941:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>T,contentTitle:()=>P,default:()=>C,frontMatter:()=>_,metadata:()=>r,toc:()=>E});const r=JSON.parse('{"id":"install/server-gunicorn","title":"Gunnicorn and Nginx","description":"This guide walks you through deploying a Flask Ecom using Gunicorn as a WSGI server and Nginx as a reverse proxy on an Ubuntu server.","source":"@site/docs/install/server-gunicorn.mdx","sourceDirName":"install","slug":"/install/server-gunicorn","permalink":"/docs/install/server-gunicorn","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/install/server-gunicorn.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Gunnicorn and Nginx"},"sidebar":"tutorialSidebar","previous":{"title":"Install","permalink":"/docs/category/install"},"next":{"title":"How using","permalink":"/docs/category/how-using"}}');var t=s(4848),a=s(8453),l=s(6540),i=s(4164),o=s(3104),c=s(6347),d=s(205),u=s(7485),h=s(1682),p=s(679);function x(e){return l.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,l.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function g(e){const{values:n,children:s}=e;return(0,l.useMemo)(()=>{const e=n??function(e){return x(e).map(({props:{value:e,label:n,attributes:s,default:r}})=>({value:e,label:n,attributes:s,default:r}))}(s);return function(e){const n=(0,h.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,s])}function j({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const s=(0,c.W6)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,u.aZ)(r),(0,l.useCallback)(e=>{if(!r)return;const n=new URLSearchParams(s.location.search);n.set(r,e),s.replace({...s.location,search:n.toString()})},[r,s])]}function v(e){const{defaultValue:n,queryString:s=!1,groupId:r}=e,t=g(e),[a,i]=(0,l.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!j({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const s=n.find(e=>e.default)??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:t})),[o,c]=m({queryString:s,groupId:r}),[u,h]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[s,r]=(0,p.Dv)(n);return[s,(0,l.useCallback)(e=>{n&&r.set(e)},[n,r])]}({groupId:r}),x=(()=>{const e=o??u;return j({value:e,tabValues:t})?e:null})();(0,d.A)(()=>{x&&i(x)},[x]);return{selectedValue:a,selectValue:(0,l.useCallback)(e=>{if(!j({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);i(e),c(e),h(e)},[c,h,t]),tabValues:t}}var b=s(2303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y({className:e,block:n,selectedValue:s,selectValue:r,tabValues:a}){const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,o.a_)(),d=e=>{const n=e.currentTarget,t=l.indexOf(n),i=a[t].value;i!==s&&(c(n),r(i))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const s=l.indexOf(e.currentTarget)+1;n=l[s]??l[0];break}case"ArrowLeft":{const s=l.indexOf(e.currentTarget)-1;n=l[s]??l[l.length-1];break}}n?.focus()};return(0,t.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:a.map(({value:e,label:n,attributes:r})=>(0,t.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{l.push(e)},onKeyDown:u,onClick:d,...r,className:(0,i.A)("tabs__item",f.tabItem,r?.className,{"tabs__item--active":s===e}),children:n??e},e))})}function N({lazy:e,children:n,selectedValue:s}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find(e=>e.props.value===s);return e?(0,l.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,t.jsx)("div",{className:"margin-top--md",children:r.map((e,n)=>(0,l.cloneElement)(e,{key:n,hidden:e.props.value!==s}))})}function w(e){const n=v(e);return(0,t.jsxs)("div",{className:(0,i.A)("tabs-container",f.tabList),children:[(0,t.jsx)(y,{...n,...e}),(0,t.jsx)(N,{...n,...e})]})}function S(e){const n=(0,b.A)();return(0,t.jsx)(w,{...e,children:x(e.children)},String(n))}const I={tabItem:"tabItem_Ymn6"};function k({children:e,hidden:n,className:s}){return(0,t.jsx)("div",{role:"tabpanel",className:(0,i.A)(I.tabItem,s),hidden:n,children:e})}const _={sidebar_position:1,title:"Gunnicorn and Nginx"},P="\ud83d\ude80 Deploying a Ecom on Ubuntu with Gunicorn and Nginx",T={},E=[{value:"\ud83e\uddf0 Requirements",id:"-requirements",level:2},{value:"Step 1: \ud83d\udd27 Update Your System",id:"step-1--update-your-system",level:2},{value:"Step 2: \ud83d\udc0d Install Python, pip, and venv (if not installed)",id:"step-2--install-python-pip-and-venv-if-not-installed",level:2},{value:"Step 3: \ud83c\udfd7\ufe0f Create Project and Virtual Environment",id:"step-3-\ufe0f-create-project-and-virtual-environment",level:2},{value:"Step 4: \ud83d\udce4 Upload code to server",id:"step-4--upload-code-to-server",level:2},{value:"Step 5: \ud83d\udd25 Install Requirements and Test App",id:"step-5--install-requirements-and-test-app",level:2},{value:"Step 6: \ud83c\udf10 Install and Configure Nginx",id:"step-6--install-and-configure-nginx",level:2},{value:"Step 7: \u2699\ufe0f Run Gunicorn as a systemd Service",id:"step-7-\ufe0f-run-gunicorn-as-a-systemd-service",level:2},{value:"\ud83d\udd10 (Optional) Enable HTTPS with Let\u2019s Encrypt",id:"-optional-enable-https-with-lets-encrypt",level:2},{value:"\u2705 Access Your App",id:"-access-your-app",level:2}];function q(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"-deploying-a-ecom-on-ubuntu-with-gunicorn-and-nginx",children:"\ud83d\ude80 Deploying a Ecom on Ubuntu with Gunicorn and Nginx"})}),"\n",(0,t.jsx)(n.p,{children:"This guide walks you through deploying a Flask Ecom using Gunicorn as a WSGI server and Nginx as a reverse proxy on an Ubuntu server."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"-requirements",children:"\ud83e\uddf0 Requirements"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Ubuntu 20.04 or 22.04 server"}),"\n",(0,t.jsx)(n.li,{children:"Python 3 installed"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"sudo"})," privileges"]}),"\n",(0,t.jsx)(n.li,{children:"Public IP or domain (for Nginx access)"}),"\n",(0,t.jsxs)(n.li,{children:["First need the source code provided by ",(0,t.jsx)(n.strong,{children:"Python Vietnam"})," - ",(0,t.jsx)(n.a,{href:"https://pythonvn.com/ecom-python/",children:"download now"})]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"step-1--update-your-system",children:"Step 1: \ud83d\udd27 Update Your System"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt update && sudo apt upgrade -y\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-2--install-python-pip-and-venv-if-not-installed",children:"Step 2: \ud83d\udc0d Install Python, pip, and venv (if not installed)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt install python3 python3-pip python3-venv -y\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-3-\ufe0f-create-project-and-virtual-environment",children:"Step 3: \ud83c\udfd7\ufe0f Create Project and Virtual Environment"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mkdir ~/project_name\ncd ~/project_name\npython3 -m venv venv\nsource venv/bin/activate\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-4--upload-code-to-server",children:"Step 4: \ud83d\udce4 Upload code to server"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Move code to server using ssh"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Ubuntu server is running, has SSH account (eg ubuntu@123.123.123.123)"}),"\n",(0,t.jsx)(n.li,{children:"On the server there is a directory /home/ubuntu/flask_project"}),"\n",(0,t.jsx)(n.li,{children:"Install Python, Flask, Gunicorn, Nginx on the server as instructed above"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\ud83d\udd11 Test SSH server access"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ssh ubuntu@123.123.123.123\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"If prompted for a password: type it in Or set up an SSH key for convenience (run once):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ssh-keygen -t rsa -b 4096\nssh-copy-id ubuntu@123.123.123.123\n"})}),"\n",(0,t.jsxs)(S,{children:[(0,t.jsxs)(k,{value:"Window",label:"Window",default:!0,children:[(0,t.jsx)(n.p,{children:"Use the application below to connect and upload the code to the server:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://winscp.net/eng/index.php",children:"WinSCP"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://filezilla-project.org/",children:"FileZilla"})}),"\n"]})]}),(0,t.jsxs)(k,{value:"Mac Os",label:"Mac Os",children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Upload using Scp:"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"scp -r ~/folder-local/*  user@<IP>:/project-folder\n"})}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"folder-local:"})," Project folder path on your computer."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"project-folder:"})," Project folder path on server."]}),"\n"]}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Upload using Rsync:"})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"rsync -avz ~/folder-local/* user@<IP>:/project-folder\n"})}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"folder-local:"})," Project folder path on your computer."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"project-folder:"})," Project folder path on server."]}),"\n"]})]})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Directory Structure"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"/home/<user>/<project_name>/\n|\u2013\u2013 app\n\u251c\u2500\u2500 wsgi.py\n\u251c\u2500\u2500 venv/\n|\u2013\u2013 requirements.txt\n\u2514\u2500\u2500 config.py\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-5--install-requirements-and-test-app",children:"Step 5: \ud83d\udd25 Install Requirements and Test App"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Install Requirements:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pip install -r requirements.txt\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Test App:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python wsgi.py\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"The command line displayed as follows was successful."})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.\n * Running on http://127.0.0.1:5000\nPress CTRL+C to quit\n * Restarting with stat\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-6--install-and-configure-nginx",children:"Step 6: \ud83c\udf10 Install and Configure Nginx"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Install Nginx:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt install nginx -y\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Create a new config file:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/nginx/sites-available/project_name\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Insert code:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"server {\n    listen 80;\n    server_name domain_name.com;  # Change this to your domain_name if you have one\n\n    location / {\n        proxy_pass http://127.0.0.1:5000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Enable the site:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo ln -s /etc/nginx/sites-available/flask_project /etc/nginx/sites-enabled\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"sudo rm /etc/nginx/sites-enabled/default"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo rm /etc/nginx/sites-enabled/default\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check and restart Nginx:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo nginx -t\nsudo systemctl restart nginx\n"})}),"\n",(0,t.jsx)(n.h2,{id:"step-7-\ufe0f-run-gunicorn-as-a-systemd-service",children:"Step 7: \u2699\ufe0f Run Gunicorn as a systemd Service"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Create the service file:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo nano /etc/systemd/system/flask_project.service\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Paste and adjust the paths and user accordingly:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'[Unit]\nDescription=Gunicorn instance to serve Project Name\nAfter=network.target\n\n[Service]\nUser=$USER\nGroup=$GROUP\nWorkingDirectory=/home/user/project_folder # Path project folder\nEnvironment="PATH=/home/user/project_folder/venv/bin" # Path project /bin\nExecStart=/home/user/project_folder/venv/bin/gunicorn --workers 3 --bind unix:project_name.sock -m 007 wsgi:app --access-logfile /home/user/project_folder/log/access.log --error-logfile /home/user/project_folder/log/error.log\n\n[Install]\nWantedBy=multi-user.target\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Note:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"/home/user:"})," User login ssh"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"/home/user/project_folder:"})," Main folder project"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Reload and enable:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reexec\nsudo systemctl start project_name\nsudo systemctl enable project_name\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check status:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo systemctl status flask_project\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-optional-enable-https-with-lets-encrypt",children:"\ud83d\udd10 (Optional) Enable HTTPS with Let\u2019s Encrypt"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt install certbot python3-certbot-nginx -y\nsudo certbot --nginx\n"})}),"\n",(0,t.jsx)(n.p,{children:"Follow the prompts to get a free SSL certificate."}),"\n",(0,t.jsx)(n.h2,{id:"-access-your-app",children:"\u2705 Access Your App"}),"\n",(0,t.jsx)(n.p,{children:"Open your browser and go to:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"https://your-domain.com\n"})})]})}function C(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(q,{...e})}):q(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>i});var r=s(6540);const t={},a=r.createContext(t);function l(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);